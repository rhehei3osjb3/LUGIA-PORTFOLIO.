<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LUGIA â€” Portfolio (Fixed gallery + modal)</title>
<style>
  :root{
    --bg:#05060a;
    --card:#0f1116;
    --muted:#9fbdd6;
    --white:#e9f7ff;
    --max-player-w:1100px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#07111a);color:var(--white);font-family:Inter,Arial,system-ui;-webkit-font-smoothing:antialiased;scroll-behavior:smooth}
  header{display:flex;align-items:center;justify-content:space-between;padding:18px 28px}
  .logo{font-family:Orbitron,monospace;font-weight:800;letter-spacing:.12em;font-size:18px}
  main{padding:18px 28px;max-width:1280px;margin:0 auto}
  .hero{max-width:980px;margin:6px auto 24px;text-align:center}
  .title-big{font-family:Orbitron,monospace;font-size:clamp(28px,6vw,56px);font-weight:800;margin:6px 0}
  .sub{color:var(--muted);max-width:820px;margin:10px auto 0;font-size:14px;line-height:1.45}

  /* GRID (balanced): use aspect-ratio so each thumb has the same height */
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px;margin-top:20px}
  .card{background:var(--card);border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,0.04);cursor:pointer;display:flex;flex-direction:column;transition:transform .18s ease,box-shadow .18s ease}
  .card:hover{transform:translateY(-6px);box-shadow:0 24px 80px rgba(0,0,0,0.6)}
  .thumb{width:100%;aspect-ratio:16/9;background:#000;display:block;position:relative}
  .thumb img{width:100%;height:100%;object-fit:cover;display:block}
  .meta{padding:10px 12px;display:flex;align-items:center;justify-content:space-between}
  .label{font-family:Orbitron,monospace;font-weight:700;font-size:13px}
  .idx{font-family:Orbitron,monospace;font-weight:800;font-size:12px;background:linear-gradient(90deg,#00f0ff,#ff00d0);color:#071022;padding:6px 8px;border-radius:10px}

  /* small play badge overlay */
  .play-badge{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:2;font-size:28px;opacity:0.96;pointer-events:none;color:rgba(255,255,255,0.95);text-shadow:0 10px 30px rgba(0,0,0,0.6)}

  /* MODAL / PLAYER (constrained) */
  .overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.65);backdrop-filter:blur(4px);z-index:1400}
  .overlay.open{display:flex}
  .player{width:min(var(--max-player-w),92vw);max-height:80vh;border-radius:12px;background:#000;border:1px solid rgba(255,255,255,0.06);overflow:hidden;display:flex;flex-direction:column}
  .media-wrap{flex:1;display:flex;align-items:center;justify-content:center;background:#000;padding:8px}
  .player video,.player img{max-width:100%;max-height:calc(80vh - 64px);object-fit:contain;display:block}
  .bar{height:56px;display:flex;align-items:center;gap:12px;padding:8px 12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01))}
  .pill{padding:8px 12px;border-radius:999px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);cursor:pointer}

  /* small spinner */
  .spinner{width:36px;height:36px;border-radius:50%;border:4px solid rgba(255,255,255,0.08);border-top-color:var(--white);animation:spin .9s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}

  /* music compact toggle */
  .music-toggle{position:fixed;left:18px;bottom:18px;width:44px;height:44px;border-radius:12px;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:1500;border:1px solid rgba(255,255,255,0.06);cursor:pointer}

  footer{padding:18px;text-align:center;color:var(--white);font-family:Orbitron,monospace;font-weight:700;letter-spacing:.08em}
  @media (prefers-reduced-motion:reduce){*{animation:none!important;transition:none!important}}
</style>
</head>
<body>
  <header>
    <div class="logo">âŸª LUGIA âŸ«</div>
    <div style="color:var(--muted);font-size:13px">Portfolio â€” click tiles to view demos</div>
  </header>

  <main>
    <section class="hero">
      <div class="title-big">LUGIA</div>
      <p class="sub">Made by Lugia. These short clips show real systems I built and tested myself â€” interface, NPCs, admin tools, a reliable hatching system and a tidy inventory. Click any tile to watch the demo.</p>
    </section>

    <!-- GRID -->
    <section class="grid" id="grid" aria-live="polite" aria-label="Showcase videos">
      <!-- JS will populate cards -->
    </section>
  </main>

  <!-- constrained player modal -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="player" role="document">
      <div class="media-wrap" id="mediaWrap">
        <div id="loading" style="display:none"><div class="spinner" aria-hidden="true"></div></div>
        <video id="playerVideo" controls playsinline style="display:none"></video>
        <img id="playerImage" alt="screenshot" style="display:none;max-width:100%;height:auto"/>
      </div>
      <div class="bar">
        <div class="pill" id="backBtn" role="button" aria-label="Close">âŸµ Back</div>
        <div class="pill" id="playerTitle">Loadingâ€¦</div>
        <div style="flex:1"></div>
        <div class="pill" id="muteToggle">Mute</div>
      </div>
    </div>
  </div>

  <div class="music-toggle" id="musicToggle" title="Music">ðŸ”ˆ</div>

  <footer id="footerText">LUGIA/LUMINOUS</footer>

  <!-- bgm -->
  <audio id="bgm" src="./Warriyo, Laura Brehm - Mortals (Slowed) [NCS Release].mp3" loop preload="auto"></audio>

<script>
/* ---------- configuration: exact files and labels (user-provided filenames) ---------- */
const files = [
  { src: 'Roblox-2025-08-25T13_31_34.454Z (1) (1).mp4', label: 'NPC' },
  { src: 'Screen Recording 2025-08-18 080949 (1).mp4', label: 'VIP Tag (Chat)' },
  { src: 'Screen_Recording_2025-08-27_184500 (2).mp4', label: 'Inventory' },
  { src: 'Screen_Recording_2025-08-30_195352.mp4', label: 'Interface' },
  { src: 'Screenshot 2025-08-26 152034.png', label: 'Admin Commands' }, // image file
  { src: 'comeplete work showcase (1) (2).mp4', label: 'Hatching System' }
];

const fallbackPoster = 'Screenshot 2025-08-26 152034.png'; // your uploaded screenshot as fallback

/* ---------- helpers ---------- */
const isImageFile = (name) => /\.(png|jpe?g|gif)$/i.test(name);
const safeUrl = (name) => './' + encodeURIComponent(name);

/* try load a candidate image URL; returns a Promise that resolves true on success */
function testImage(url){
  return new Promise((resolve)=>{ const i = new Image(); i.onload = ()=>resolve(true); i.onerror = ()=>resolve(false); i.src = url; });
}

/* build grid with thumbnails (fast) */
const grid = document.getElementById('grid');

async function buildGrid(){
  for(let i=0;i<files.length;i++){
    const item = files[i];
    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.src = item.src;
    card.dataset.index = i;

    const thumb = document.createElement('div');
    thumb.className = 'thumb';

    const playBadge = document.createElement('div');
    playBadge.className = 'play-badge';
    playBadge.innerHTML = 'â–¶';
    thumb.appendChild(playBadge);

    const img = document.createElement('img');
    img.alt = item.label + ' thumbnail';
    img.loading = 'lazy';

    // strategy: if the original is an image, use it. Otherwise try a few candidate poster filenames:
    if(isImageFile(item.src)){
      img.src = safeUrl(item.src);
    } else {
      // candidates (in order): same basename with .png, thumb-<basename>.png, fallbackPoster
      const base = item.src.replace(/\.[^/.]+$/, '');
      const candidates = [
        safeUrl(base + '.png'),
        safeUrl('thumb-' + base + '.png'),
        safeUrl(item.src.replace(/\.[^/.]+$/, '') + '.jpg'),
        safeUrl(fallbackPoster)
      ];

      // try sequentially, first existing wins
      let chosen = null;
      for(const c of candidates){
        try{
          // testImage returns quickly; if it resolves true, use it
          // avoid blocking page layout; do it sequentially in small async intervals
          // (this loop will not freeze; images are tested in the background)
          // Note: on GitHub Pages some images may 404 if not present â€” that's OK
          // use await so we pick the first good candidate in order
          const ok = await testImage(c);
          if(ok){ chosen = c; break; }
        }catch(e){}
      }
      img.src = chosen || safeUrl(fallbackPoster);
    }

    thumb.appendChild(img);

    const meta = document.createElement('div');
    meta.className = 'meta';
    const label = document.createElement('div'); label.className = 'label'; label.textContent = item.label;
    const idx = document.createElement('div'); idx.className = 'idx'; idx.textContent = (i+1).toString();
    meta.appendChild(label); meta.appendChild(idx);

    card.appendChild(thumb); card.appendChild(meta);

    // click to open player
    card.addEventListener('click', ()=> openPlayer(item));

    grid.appendChild(card);
  }
}

/* ---------- player modal ---------- */
const overlay = document.getElementById('overlay');
const playerVideo = document.getElementById('playerVideo');
const playerImage = document.getElementById('playerImage');
const playerTitle = document.getElementById('playerTitle');
const backBtn = document.getElementById('backBtn');
const loadingEl = document.getElementById('loading');
const bgm = document.getElementById('bgm');
const musicToggle = document.getElementById('musicToggle');
const muteToggle = document.getElementById('muteToggle');

let bgmWasPlaying = false;
let lastFocused = null;

function showLoading(on = true){
  loadingEl.style.display = on ? 'block' : 'none';
}

/* open player: set src only when opening */
async function openPlayer(item){
  lastFocused = document.activeElement;
  playerTitle.textContent = item.label;
  // pause bgm if playing
  bgmWasPlaying = !bgm.paused && !bgm.ended;
  if(bgmWasPlaying) bgm.pause();

  overlay.classList.add('open');
  overlay.setAttribute('aria-hidden','false');
  showLoading(true);
  document.documentElement.style.overflow = 'hidden';
  document.body.style.overflow = 'hidden';

  if(isImageFile(item.src)){
    playerVideo.style.display = 'none';
    playerVideo.pause();
    playerImage.style.display = 'block';
    playerImage.src = safeUrl(item.src);
    showLoading(false);
    // focus close/back for accessibility
    backBtn.focus();
  } else {
    playerImage.style.display = 'none';
    playerImage.removeAttribute('src');
    playerVideo.style.display = 'block';
    // set src safely (encoded)
    playerVideo.src = safeUrl(item.src);
    playerVideo.currentTime = 0;
    try{
      await playerVideo.play();
      showLoading(false);
    }catch(err){
      // video couldn't autoplay (network or browser policy): show controls and let user press play
      showLoading(false);
      // if play failed, still keep controls visible; focus the video so user can press play
      playerVideo.focus();
    }
    backBtn.focus();
  }
}

/* close player */
function closePlayer(){
  overlay.classList.remove('open');
  overlay.setAttribute('aria-hidden','true');
  try{ playerVideo.pause(); }catch(e){/*ignore*/}
  // remove src to free decoder
  playerVideo.removeAttribute('src');
  playerVideo.load();
  playerImage.removeAttribute('src');
  playerImage.style.display = 'none';
  showLoading(false);

  document.documentElement.style.overflow = '';
  document.body.style.overflow = '';
  // resume bgm only if it was playing before
  if(bgmWasPlaying && bgm.paused){ bgm.play().catch(()=>{}); }

  // restore focus
  if(lastFocused && typeof lastFocused.focus === 'function') lastFocused.focus();
}

/* keyboard support */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape' && overlay.classList.contains('open')) closePlayer();
});

/* click backdrop to close */
overlay.addEventListener('click', (e)=>{
  if(e.target === overlay) closePlayer();
});

backBtn.addEventListener('click', closePlayer);

/* mute toggle for player (separate from bgm) */
let playerMuted = false;
muteToggle.addEventListener('click', ()=>{
  playerMuted = !playerMuted;
  playerVideo.muted = playerMuted;
  muteToggle.textContent = playerMuted ? 'Unmute' : 'Mute';
});

/* ---------- background music: autoplay attempt + fallback ---------- */
bgm.volume = 0.18;
(async function initBGM(){
  try{
    await bgm.play();
    musicToggle.textContent = 'ðŸ”Š';
    musicToggle.title = 'Click to mute background music';
  }catch(e){
    // autoplay blocked â€” we'll wait for first interaction
    musicToggle.textContent = 'ðŸ”ˆ';
    musicToggle.title = 'Enable background music (tap)';
    const onFirst = async ()=>{
      try{ await bgm.play(); musicToggle.textContent='ðŸ”Š'; musicToggle.title='Click to mute background music'; }
      catch(e){ musicToggle.textContent='ðŸ”ˆ'; musicToggle.title='Autoplay blocked'; }
      document.removeEventListener('pointerdown', onFirst);
      document.removeEventListener('keydown', onFirst);
    };
    document.addEventListener('pointerdown', onFirst, {once:true});
    document.addEventListener('keydown', onFirst, {once:true});
  }
})();

/* compact music toggle behaviour */
musicToggle.addEventListener('click', async ()=>{
  if(bgm.paused){ try{ await bgm.play(); musicToggle.textContent='ðŸ”Š'; musicToggle.title='Click to mute background music'; }catch(e){ musicToggle.textContent='ðŸ”ˆ'; musicToggle.title='Autoplay blocked'; } }
  else{ bgm.pause(); musicToggle.textContent='ðŸ”ˆ'; musicToggle.title='Enable background music'; }
});

/* ---------- initialize ---------- */
buildGrid().catch(e=>{ console.error('Failed to build grid',e) });

/* small safety: if the poster detection loop is slow, the grid still renders using fallback poster quickly.
   file downloads are only images (fast) â€” videos are NOT loaded until you open the modal. */
</script>
</body>
</html>
